---
layout: single
title: "대량 회원가입 처리, 코루틴과 병렬 처리를 선택한 이유"
categories:
  - personal
sidebar:
  nav: "sidebar-category"
---

대량 회원가입을 구현하면서 다음과 같은 시행착오를 겪었다.

1. 단순하게 반복문으로 처리하니까 2천 명 회원가입 시킬 때에도 거의 10분이 걸림 (+ 로컬테스트임에도 컴퓨터 느려지는 건 덤)
2. 스레드 기반으로 병렬 처리하니까 이전 스레드가 끝나야 다음 스레드가 실행되기 때문에 대기 시간이 길어짐 2천 명 처리할 때 약 4분 소요
3. 서버 사양을 살펴보니 단일 코어로 멀티스레드 사용이 의미가 없음 -> 스레드 사용 하지마!~~!
4. 하다가 코루틴 기반이 낫겠다 생각하고 수정

## 스레드 기반 vs 코루틴 기반
- 스레드 기반
  - 식당에서 손님이 오면 직원 1명씩 전담 배치하는 방식
  - 손님이 밥을 기다리고 있으면 직원도 아무것도 못함
  - 직원 수가 한정되어 있어서, 받을 수 있는 손님의 수도 한정되어 있고 손님 대기줄이 길어짐
- 코루틴 기반
  - 식당 직원이 여러 테이블을 오가며 동시에 서비스하는 방식
  - 한 테이블에서 기다리는 동안, 다른 테이블에 서비스를 할 수 있음
  - 적은 직원으로 많은 손님 응대 가능

적은 리소스로 많은 작업을 처리할 수 있는 것이 멀티 스레드를 사용하지 못하는 서버 상태에 더 적합하다고 생각하셔 적용했다.


## 병렬 처리를 한 이유
- 병렬 처리는 지금과 같은 대량 회원가입과 같이 기다리는 시간이 많은 작업에서 효과가 큼
- 처리 건수가 수천 건 이상이거나, I/O 대기 시간이 어느 정도 있는 경우에 용이함
