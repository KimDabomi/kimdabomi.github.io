---
layout: single
title: "[AWS] IAM 및 AWS CLI"
categories:
  - aws
sidebar:
  nav: "sidebar-category"
---

AWS 계정을 사용할 수 있도록 하기 위한 도구, 권한 부여가 필요<br />
`JSON`파일로 정책을 정해줌으로써 보안을 확보해야함<br />
AWS는 사용자가 꼭 필요로 하는 것 이상의 권한을 주지 않음<br />

### 1. IAM 생성 후 계정 별칭 설정

`IAM` - 대시보드 우측 탭에서 계정 별칭을 설정하고, 아래 URL을 통해서 로그인을 할 수 있음

### 2. IAM 정책

```
{
    "Version": "2012-10-17", // 정책 언어 버전
    "Id": "S3-Account-Permissions", // 정책 식별 아이디
    "Statement": [ // 구성 요소
        {
            "Sid": "1", // 문장 아이디, 식별자
            "Effect": "Allow", // 문장이 특정 API에 접근하는 걸 허용할지 거부할지 결정
            "Principal": { // 특정 정책이 적용될 사용자, 계정, 역할로 구성
                "AWS": ["arn:aws:iam::123456789012:root"]
            },
            "Action": [ // effect에 의해 허용 및 거부되는 API 목록
                "s3:GetObject",
                "s3:PutObject"
            ],
            "Resource": ["arn:aws:s3:::mybucket/*"] // 적용될 action의 리소스 목록
        }
    ]
}
```

### 3. 사용자들의 정보 보호
- 비밀번호 정책의 정의
	- 최소 길이 설정
	- 특정 문자 설정
	- 비밀번호 변경 금지
	- 비밀번호 만료
	- 비밀번호 재사용 금지
- 다요소 인증, `MFA`
	- 루트 계정은 무슨 일이 있어도 보호되어야 하며, 전체 `IAM` 사용자들도 보호해야 함
	- `MFA` - 우리가 알고 있는 비밀번호와 보안장치를 함께 사용하는 것
	- 해킹을 당해서 비밀번호가 누출된 상황이라고 해도 해커에게는 사용자 소유의 물리적 장치가 추가로 필요해지기 때문에, 계정이 침해당하지 않음
	- 가상 `MFA` 장치
		- `Google Authenticator` - 하나의 휴대전화에서만 사용 가능
		- `Authy` - 하나의 장치에서도 여러 개의 토큰 제공
		- `YubiKey` - 열쇠 같은 물리적 장치
		- `Hardware Key Fob`


### 4. AWS에 액세스 하는 방법
- AWS 콘솔 - 사용자 이름, 비밀번호 등으로 보호됨
- `CLI` - 명령줄 인터페이스, 액세스 키에 의해 보호됨
- `SDK` - AWS 소프트웨어 개발자 키트, AWS로부터 애플리케이션 코드 내에서 API를 호출하고자 할 때 사용

#### `CLI` - 명령줄 인터페이스, 액세스 키에 의해 보호됨
- 명령줄 쉘에서 명령어를 사용하여 AWS 서비스들과 상호작용할 수 있도록 해주는 도구
- AWS 서비스의 공용 API로 직접 액세스가 가능
- 리소스를 관리하는 스크립트를 개발해 일부 작업을 자동화할 수 있음
- 오픈 소스, AWS의 관리 콘솔로 쓰일 수 있음

#### `SDK` - AWS 소프트웨어 개발자 키트, AWS로부터 애플리케이션 코드 내에서 API를 호출하고자 할 때 사용
- 소프트웨어 개발 키트, 특정 언어로 된 라이브러리의 집합 -> 프로그래밍 언어에 따라 개별 `SDK`가 존재
- 터미널 내에서는 사용하는 것이 아니라, 코딩을 통해서 애플리케이션 내에 심어두어야 함
- 애플리케이션 내에 자체적으로 `AWS SDK`가 있는 것, 다양한 프로그래밍 언어를 지원함


### 5. IAM ROLE
- AWS 기능 몇 가지는 우리의 계정에서 실행해야 하므로, 사용자와 마찬가지로 어떤 권한이 필요
- 따라서 AWS 서비스에 권한을 부여하기 위해서 `IAM ROLE`을 만들어야함
- 인스턴스는 가상 서버로, 인스턴스에서 어떤 실행을 하려면 권한을 부여해야함
- 이를 위해서 `IAM ROLE`를 만들고 하나의 객체로 만들어야함
- 인스턴스가 AWS 서비스에 접근하려고 할 때 `IAM ROLE`을 사용함
- `EC2 Instance Roles`
- `Lambda Function Roles`
- `Roles for CloudFormation`


### 6. IAM 보안 도구
- 자격 증명 보고서 - 계정 수준에서 가능, 계정에 있는 사용자와 다양한 자격 증명의 상태를 포함
- 액세스 관리자 - 사용자 수준에서 가능, 사용자에게 부여된 서비스의 권한과 해당 서비스에 마지막으로 액세스한 시간이 보임
  - 최소권한의 원칙에 따랐을 때 매우 도움, 어떤 권한이 사용되지 않는지 확인하고 사용자의 권한을 줄일 수 있음

### 7. IAM 모범 사례
- 루트 계정은 AWS 계정을 설정할 때를 제외하고는 사용하지 않음
- 하나의 AWS 사용자는 한 명의 실제 사용자를 의미
- 사용자를 그룹에 넣어 해당 그룹에 권한을 부여하고, 그룹 수준에서 보안을 관리할 수 있음
- 비밀번호 정책을 강화해야 함, `MFA`를 사용할 수 있다면 계정 보호에 좋음
- AWS 서비스에 권한을 부여할 때마다 역할을 만들고 사용해야함, `EC2` 인스턴스도 포함
- `CLI`나 `SDK`를 사용할 경우, 반드시 액세스 키를 만들어야함
- 계정의 권한을 감사할 때에는 자격 증명 보고서와 액세스 분석기를 사용할 수 있음
- 절대 `IAM` 사용자와 액세스 키를 공유하지 말 것


### 8. IAM 요약
- `Users` - `IAM`사용자는 실제 물리적 사용자와 매핑되어야 하며, 이 사용자는 AWS 콘솔 비밀번호를 갖게 됨
- `Groups` - 사용자를 그룹화할 수 있음
- `Policies` - 사용자 또는 그룹에 대한 권한을 설명하는 정책을 첨부할 수 있음
- `Roles` - `EC2` 인스턴스나 기타 AWS 서비스에 대한 역할 부여
- `Security` - 보안을 위해 `MFA`를 활성화할 수 있음. 비밀번호 정책도 설정 가능
- `AWS CLI` - `CLI`를 사용하여 서비스를 관리
- `AWS SDK` - `SDK`를 사용하여 프로그래밍 언어로 AWS 서비스를 관리
- `Access Keys` - `CLI`, `SDK` 등을 사용하여 액세스 키를 생성할 수 있음
- `Audit` - `IAM` 자격 증명 보고서 생성, 액세스 어드바이저를 통해서 사용량을 감사할 수 있음
