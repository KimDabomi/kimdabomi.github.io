---
layout: single
title: "[우테코] 프리코스 6기 2주차 - 자동차 경주"
categories:
  - education
sidebar:
  nav: "sidebar-category"
---

> [2주차 자동차 경주 게임](https://github.com/woowacourse-precourse/java-racingcar-6)

> [내 PR 주소](https://github.com/woowacourse-precourse/java-racingcar-6/pull/40)

💡이번주의 크게 잡은 목표!
1. 설계부터 열심히! 기능별로 메서드 최대한 작게!!
2. 메서드마다 테스트해보기 -> 이래야 기능별 커밋도 꼬이지 않을듯
3. 하드코딩 최대한 피하기
4. 커밋 컨벤션 잘맞춰서 하자. (브랜치명...절대 바꾸지마...)


### ✅ 구현 기능 목록

- `race package`
  - `Car` 자동차
    - `getCarName` 자동차 이름
    - `getPosition` 자동차 위치
    - `move` 이동
  - `MoveStatus` 전진 여부 결정
    - 랜덤 수 4이상
      - 랜덤 수는 0~9 사이의 정수
  - `Race` 경주 시작
    - `startRace` 시도 횟수 만큼 전진 여부 결정
    - `getWinners` 위치가 제일 높은 사람이 우승
- `variable package`
  - `MagicVariable` 상수와 문장 변수로 지정
- `view package`
  - `InputView` 사용자 입력
    - `getTryCount` 시도 횟수
    - `getCarNameInput` 자동차 이름
    - 예외
      - `checkCarNameExceptions` 자동차 이름
        - `carNameRullException` 쉼표로 구분, 5자 이하 소문자만 가능, 공백 입력 불가
        - `carNameDuplicateException` 중복값 입력 불가
      - `checkTryCountExceptions` 시도 횟수는 1이상의 자연수만 가능
  - `OutputView` 결과
    - `printRace` 게임 진행 출력
    - `printWinners` 공동 우승일 경우 쉼표로 구분
- `game package`
  - `PlayGame` 게임 시작
    - `playGame` 게임 시작 후 입력값 받기
    - `playRace` 입력값을 토대로 경주 시작

### ✅ 다이어그램
![wooteco-6-2-1](/assets/images/wooteco-6-2-1.png)

확실히 그리고 나서 구현하고, 구현하고 나서 다시 점검하고 추가하면서 하다보니 로직이 더 잘보인다.

![wooteco-6-2-2](/assets//images//wooteco-6-2-2.png)


### ✅ 테스트 코드
![wooteco-6-2-3](/assets/images//wooteco-6-2-3.png)

테스트 코드는 처음 작성해보는 거였는데, 무엇보다 사용자의 입력값을 임의로 System.in으로 부여하거나
출력값을`System.out`으로 지정해주는 게 몰랐던 방법이였는데<br />

테스트 코드를 작성하면서 `Scanner`의 내부 로직이 마지막에 `System.in`까지 가서 `close`를 해줘야되는 것까지...
`close`하는 거 스터디원 분이 전날 말씀해주셨는데, 무슨말인지 이해 못하다가 No line어쩌구 에러를 보자마자 알았다...<br />

근데 콘솔 임포트를 잘못했어서 ㅠ 한참 못하다가 겨우했다...! 다 처음이여서 어려웠지만 그만큼 공부가 많이 됐다.
그래도 클래스마다 구현하려고 노력했다. 결국 `PlayGame`은 기능이 `Application`이랑 똑같아서 구현하지 않았지만
5개의 테스트 클래스를 만들었다...<br />

그리고 `InputView`에서 이름 검사하는 걸 내부클래스와 테스트에서만 쓰길래 테스트용 메서드를 따로 나눴다.
우테코에서 제공된 `ApplicationTest`는 저번미션 때 건드렸다가, 제출할 때 한참 에러 났어서.. 건드리지 않았다.<br />

다른 클래스에 대한 테스트코드들은 `DisplayName`도 지정해줬다.

``` java
private final InputStream originalSystemIn = System.in;

private void provideInput(String inputData) {
    System.setIn(new ByteArrayInputStream(inputData.getBytes()));
}

@BeforeEach
public void init() {
    System.setIn(originalSystemIn);
}

@AfterEach
public void afterInit() {
    Console.close();
}
```

출력값도 임의로 저장해주기... \n이 엔터 대신으로 된다는 것도 처음 알았다 ㅋㅋㅋ ㅋ ㅋ 신기한 자바의 세계

``` java
@BeforeEach
void setUp() {
    System.setOut(new PrintStream(byteArrayOutputStream));
    cars = Arrays.asList(new Car("kim"), new Car("mi"));
    winners = Arrays.asList(new Car("kim"), new Car("mi"));
}

@AfterEach
public void restoreStreams() {
    Console.close();
}
```


### ✅ 새로운 사용

전체적인 구현할 기능 자체는 숫자 야구보다 더 쉬웠지만, 테스트코드를 작성해야된다는 게 걱정됐었다...<br />
저번 미션 코드리뷰하면서 느낀 게 있다면 아래 네 가지를 지켜야겠다는 거였다!

1. 매직변수, 예외를 따로 빼자.
2. 스트림이나 리스트, 가독성을 신경쓰자.
3. 메서드명 신경쓰기.
4. 입력화면, 결과화면을 따로 빼자.

``` java
private void carNameDuplicateException(String[] carNames, Set<String> uniqueNames) {
    if (uniqueNames.size() != carNames.length) {
        throw new IllegalArgumentException(magicVariable.CAR_DUPLICATE_ERROR_MESSAGE);
    }
}

private void carNameRullException(String carName) {
    if (!carName.matches(magicVariable.CAR_NAME_RULE)) {
        throw new IllegalArgumentException(magicVariable.CAR_NAME_ERROR_MESSAGE);
    }
}

public void checkCarNameExceptions(String[] carNames) {
    Set<String> uniqueNames = new HashSet<>(Arrays.asList(carNames));
    carNameDuplicateException(carNames, uniqueNames);

    for (String carName : carNames) {
        carNameRullException(carName);
    }
}

public void checkTryCountExceptions(int tryCount) {
    if (tryCount <= magicVariable.PICK_NUM_MIN) {
        throw new IllegalArgumentException(magicVariable.TRY_COUNT_RANGE_ERROR_MESSAGE);
    }
}
```

이런식으로 예외도 따로 메서드로 빼고 매직변수로 메세지도 다 대체하니까, 굉장히 직관적인 느낌이였다.<br />
`stream`도 활용해보려고 했는데, `position`중에서 가장 큰 값을 찾아내는 데에 쓰면 유용할 것 같아서 써봤는데 스트림 너무 헷갈린다!ㅜㅜ

``` java
public List<Car> getWinners() {
    int maxPosition = cars.stream()
            .mapToInt(Car::getPosition)
            .max()
            .orElse(0);

    return cars.stream()
            .filter(car -> car.getPosition() == maxPosition)
            .collect(Collectors.toList());
}
```

결과 화면도 따로 뺏는데, 저 최종 우승자도 하드코딩인가 싶어서 빼야되나 .... 했지만 이건 냅뒀다.<br />
레이스 시작메세지를 `startRace`에 보여주고, 우승자 메세지를 마지막 게임 끝날 때 보여주니까 한층 더 깔끔해진 느낌!

``` java
public void printRace(List<Car> cars) {
    for (Car car : cars) {
        System.out.println(car.getCarName() + " : " + "-".repeat(car.getPosition()));
    }
    System.out.println();
}

public static void printWinners(List<Car> winners) {
    String winnerNames = winners.stream()
            .map(Car::getCarName)
            .collect(Collectors.joining(", "));
    System.out.println("최종 우승자 : " + winnerNames);
}
```


### ✅ 소감

저번 미션 때 너무 설계없이 중구난방으로 구현해서, 커밋도 꼬이고 수정이 반복됐다는 걸 느끼고 이번에는 설계부터 꼼꼼히 해보자는 마음으로 임했다. 코드리뷰를 하면서 메서드별로 테스트를 해야 기능들이 꼬이지 않겠구나했는데 이번주 메일에 해당 부분을 연습해보라는 말이 있어서, 우테코와 같은 방향으로 생각했다는 게 괜히 뿌듯했다.<br />
구현하면서 저번 미션과 다르게 접근 제어자를 신경쓰면서, 클래스도 야구게임보다는 더 세세히 나누고, 메서드도 최대한 작게 만드려고 하다보니 변수를 정의해야되는 위치나 `static`, `final` 등의 사용법을 좀 더 이해하게 됐다.<br />
클래스와 기능을 세세하게 나눠서 그런지 저번 미션때는 depth 3 지키는 것도 어려웠는데 이번엔 예외부분이랑 레이스 시작 말고는 depth 문제로 메서드 분리를 한 부분도 없어서 작은 일이지만 뿌듯했다.<br />
패키지도 나누고 다이어그램도 그려보면서 로직을 한 번 더 이해하려고 했고, `getter`, `setter`없이는... 더 공부가 필요할듯 하다.<br />
<br />
이번 미션 요구사항에는 해당되지 않았지만, 포비님이 매번 강조하는 부분이라... 구현하고 싶었지만 이번 미션에 대해서 연습시키고 싶은 부분은 객체지향 프로그래밍과 단위테스트라고 생각하여 그 부분을 중점으로 했다.<br />
또 `MagicVariable` 클래스에 따로 뺐던 변수들과 `OutputView`의 경우, 공통적으로 쓰이는 부분이기에 `static` 속성으로 변경하고, `static`의 경우는 선언하자마자 메모리에 등록되어 따로 객체를 불러올 필요가 없다는 속성을 이해하면서 접근방법을 변경했다.<br />
`static`이 공통적으로 쓰이는 변수라는 개념은 알고 있었지만 객체 생성이 불필요하다는 건 새롭게 알게 된 사실이었다.<br />
<br />
처음으로 메서드와 클래스마다 각자의 역할만 가지고 있을 수 있게 신경쓰면서 작업하니까 코드도 더 단순해지고 직관적으로 보이게 된다는 걸 몸소 경험해보면서 더 많은 디자인 패턴이나 객체지향의 의미 등을 깊게 생각하고 공부하게 되었다.<br />
행동 중심으로 메세지를 보내는 것... 객체는 스스로 내 행동을 해야됨..... 명심명심<br />
앞으로 일급컬렉션, 캡슐화, MVC 패턴 등을 더 공부해야겠다는 생각을... 더 강렬하게 했다.<br />
저번주엔 아예 필요성도 못느꼈지만, 필요성을 느껴도 구현이 쉽지 않아서 더 공부해야될 것 같다 ㅠㅠ 으아아ㅏ~~<br />
정말..... 할 때 마다 느끼는 거지만 어려워.....어려워!!! 하지만 해야겠찌! 하지만 어려워!!! 하지만 해야겠지!!!!!!!!
