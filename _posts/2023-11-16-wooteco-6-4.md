---
layout: single
title: "[우테코] 프리코스 6기 4주차 - 크리스마스 프로모션"
categories:
  - education
sidebar:
  nav: "sidebar-category"
---

> [4주차 크리스마스 프로모션](https://github.com/woowacourse-precourse/java-christmas-6)

> [내 PR 주소](https://github.com/KimDabomi/java-christmas-6-KimDabomi)

 
💡이번주의 목표!

1. 인스턴스 변수 최소화
2. 중요한 기능이 뭔지 체크!
3. 테스트코드 더 연구(내장 기능 활용)
4. 클래스의 역할을 좀 더 세세하게 생각하기

이번 주차는 전처럼 포크해서 피알하는 게 아니라, 비공개 저장소를 만들어서 콜라보레이터로 초대하는 방식으로 진행됐다!

## ✅ 설계

처음 미션을 받고 뭔가 갑자기 너무 어려운 느낌이라 이번엔 흐름도도 그려봤다.
![wooteco-6-4-1](/assets/images/wooteco-6-4-1.png)

## ✅ 이벤트 목록
- 2023.12.01. ~ 2023.12.25.
  - 크리스마스 디데이 할인
    - 1000원으로 시작 -> 날마다 할인 금액이 100원씩 증가
      - 총 주문 금액에서 해당 금액만큼 할인
- 2023.12.01. ~ 2023.12.31.
  - 평일 할인(일~목) : 디저트 메뉴 1개 당 2,023원 할인
  - 주말 할인(금, 토) : 메인 메뉴 1개 당 2,023원 할인
  - 특별 할인 : 이벤트 달력에 별이 있으면 총 주문 금액에서 1,000원 할인
    - 매주 일요일 + 크리스마스 당일
  - 증정 : 할인 전 총 주문 금액이 12만원 이상 -> 샴페인 1개 증정
- 이벤트 배지
  - 5천원 이상 : 별
  - 1만원 이상 : 트리
  - 2만원 이상 : 산타
- 고객 안내 주의 사항
  - 총 주문 금액 10,000원 이상부터 적용
  - 음료만 주문은 불가
  - 메뉴는 한 번에 최대 20개까지만 주문 가능

## ⚙️ 구현 기능

### Domain

#### Exception
- [ERROR] 로 시작
- [x] 날짜
  - [x] 숫자만 입력 가능
  - [x] 1~31의 정수만 입력 가능
- [x] 주문
  - [x] 형식에 맞는 입력인지 확인
    - [x] 메뉴와 수량 2개가 모두 입력됐는지 확인 
    - [x] 주문 수량 숫자만 가능
  - [x] 총 주문 금액 10,000원 이상
  - [x] 음료만 주문 불가
  - [x] 메뉴는 한번에 최대 20개 까지만 주문 가능
  - [x] 메뉴판에 없는 메뉴 입력 불가
  - [x] 메뉴의 개수는 1이상의 숫자만 입력 가능
  - [x] 중복 메뉴 불가

#### Event 
- [x] 할인 유형 (`enum`)
- [x] 이벤트 배지 (`enum`)
- [x] 이벤트 처리
  - [x] 크리스마스 디데이 할인
  - [x] 평일/주말 할인
  - [x] 특별 할인
  - [x] 증정 할인
  - [x] 이벤트 배지 계산
  - [x] 금액 계산
    - [x] 증정 메뉴 금액 계산
    - [x] 크리스마스 할인 금액 계산
    - [x] 평일/주말 할인 금액 계산
    - [x] 특별 할인 금액 계산
    - [x] 총 혜택 금액 계산 -> 할인 금액의 합계 + 증정 메뉴의 가격
    - [x] 할인 후 예상 결제 금액 계산 -> 할인 전 총 주문 금액 - 할인 금액의 합계

#### Order
- [x] 주문 처리
  - [x] 주문 항목 리스트
  - [x] 할인 전 총 주문 금액 계산
- [x] 주문 항목
  - [x] 메뉴 아이템 & 수량

#### Menu
- [x] 메뉴 아이템
  - [x] 이름
  - [x] 가격
  - [x] 카테고리
- [x] 메뉴 카테고리 (`enum`)
  - [x] 메뉴명으로 멤버변수 조회할 수 있게 설정
  - [x] 메뉴명 사이 띄어쓰기 제거
  - [x] 존재하지 않는 메뉴 예외 체크

### View
- [x] 사용자 입력
  - [x] 방문 예정 날짜
  - [x] 메뉴 선택
    - [x] 공백 제거 (ex/ 시저 샐러드 - 1, 해물 파스타 - 1 -> 시저샐러드-1,해물파스타-1)
- [x] 결과 출력
  - [x] 주문 메뉴 
    - [x] 출력 순서 무관
  - [x] 할인 전 총 주문 금액
  - [x] 증정 메뉴 
    - [x] 없는 경우 '없음'으로 표시
  - [x] 혜택 내역
    - [x] 고객에게 적용된 이벤트 내역만 표시
    - [x] 없는 경우 '없음'으로 표시
    - [x] 여러 개의 이벤트가 적용된 경우, 출력 순서 무관
  - [x] 총 혜택 금액
  - [x] 할인 후 예상 결제 금액
  - [x] 12월 이벤트 배지 내용
    - [x] 배지가 부여되지 않은 경우, '없음'으로 표시

### Controller
- [x] 사용자 입력 처리
- [x] 모델 업데이트
- [x] 결과 표시


## ✅ 테스트 코드
![wooteco-6-4-2](/assets/images/wooteco-6-4-2.png)
![wooteco-6-4-3](/assets/images/wooteco-6-4-3.png)

저번에 새로이님이 리뷰해주신 내용이 있었는데, 저번주에는 사용해보려고 해도 감이 너무 안와서 junit메서드들을 활용을 못했는데, 드디어 했다! 이렇게 간결하고 예뻐질 수 있다니 코드가.... 진작에 했어야지 이눔아! 깔끔~

``` java
private static Stream<Arguments> provideBadgeTestData() {
    return Stream.of(
            Arguments.of(LocalDate.of(2023, 12, 4), new Order(List.of(new OrderItem(Menu.T_BONE_STEAK, "1"), new OrderItem(Menu.BBQ_RIBS, "1"), new OrderItem(Menu.CHOCOLATE_CAKE, "2"), new OrderItem(Menu.ZERO_COLA, "1"))), "산타"),
            Arguments.of(LocalDate.of(2023, 12, 27), new Order(List.of(new OrderItem(Menu.TAPAS, "1"), new OrderItem(Menu.CHOCOLATE_CAKE, "5"), new OrderItem(Menu.ZERO_COLA, "1"))), "트리"),
            Arguments.of(LocalDate.of(2023, 12, 27), new Order(List.of(new OrderItem(Menu.TAPAS, "1"), new OrderItem(Menu.CHOCOLATE_CAKE, "4"), new OrderItem(Menu.ZERO_COLA, "1"))), "별"),
            Arguments.of(LocalDate.of(2023, 12, 27), new Order(List.of(new OrderItem(Menu.TAPAS, "1"), new OrderItem(Menu.ZERO_COLA, "1"))), "없음")
    );
}
@ParameterizedTest(name = "배지유형: {2}")
@MethodSource("provideBadgeTestData")
@DisplayName("이벤트 배지 - 산타")
void testBadge(LocalDate testDate, Order testOrder, String expectedBadge) {
    int totalDiscountAmount = DiscountEvent.getTotalDiscountAmount(testOrder, testDate);
    String badge = EventBadge.getBadgeForDiscount(totalDiscountAmount);

    assertThat(badge).isEqualTo(expectedBadge);
}
```

## ✅ 새로운 사용

### `enum`에 추상 메서드를 확장해서 사용

할인금액을 계산하는 메서드들을 `enum`에서 정의하고 추상 메서드를 오버라이딩해서 사용했다! 단순 변수랑 문자열들만 처리해보다가 메서드 자체를 `enum`의 요소로는 처음 사용해봤다. 상당히 편하다. `enum` 진짜 멋진 녀석...

``` java
GIFT_CHAMPAGNE {
    @Override
    public int calculateDiscount(Order order, LocalDate date) {
        if (order.getTotalAmountBeforeDiscount() >= NumberOfEvent.EVENT_MIN_TOTAL_PRICE.getNumberOfEvent()) {
            return NumberOfEvent.CHAMPAGNE_PRICE.getNumberOfEvent();
        }

        return NumberOfEvent.ZERO.getNumberOfEvent();
    }
};

public abstract int calculateDiscount(Order order, LocalDate date);
```

### `view`의 문장들도 다 `enum`처리
### `@ParameterizedTest`, `@ValueSource`, `@MethodSource` 사용
### 함수형 인터페이스 사용

컨트롤러에서 에러메세지 표시 후 재입력을 받기 위한 `while(true)~try~catch`의 형태가 반복되어 사용되는 것 때문에, 저번 미션 때 코드리뷰 받은 걸 토대로 검색해서 해봤다! 요런식으루.... 근데 사실 찾아서 해내긴 했지만, 잘 모르겠어서 공부가 더 필요하다.

``` java
private <T> T executeWithRetry(Supplier<T> action) {
    while (true) {
        try {
            return action.get();
        } catch (IllegalArgumentException e) {
            System.out.println(e.getMessage());
        }
    }
}
```

### `enum`의 요소로 `name`을 조회할 수 있도록 설정

메뉴에 대한 `enum`을 만들 때, `enum`명은 영어로 해야되고 메뉴이름은 한글로 해야되기 때문에 한글로 입력했을 때에도 `enum`의 멤버변수들을 조회할 수 있도록 하기 위해 메뉴의 음식이름과 일치할 때 해당 메뉴를 리턴할 수 있도록 메서드를 정의해줬다.<br />
그리고 예외검사 중에 메뉴에 존재하지 않을 경우의 예외를 처리할 때, 한참동안 도메인 객체에서 처리해주다가 메뉴`enum`에서 메뉴 자체를 가져오는 메서드에서 처리해줬다.

``` java
public static Menu of(final String foodName) {
    for (Menu menu : Menu.values()) {
        if (menu.getFoodName().equalsIgnoreCase(foodName)) {
            return menu;
        }
    }
    throw new IllegalArgumentException(ErrorMessage.ORDER_NOT_VALID_ERROR_MESSAGE.getErrorMessage());
}
```

## ✅ 소감

드디어.... 끝났다 프리코스가.. 살면서 코드를 제일 오래 봤던 4주였다.<br />
그래도 1주차 숫자야구 코드부터 찬찬히 보면 나름 성장한 것 같다..!<br />
리팩토링이라는 것도 처음 해봤고, 사실 여태 프로젝트를 해도 구현하기에만 급급했지 클린코드나 객체지향같은 건 생각도 안했어서 그런지 생각하는 것 자체도 뭔가... 개발자에 가까워진 거 같달까? 핳핳핳<br />
전부터 남자친구도 코드나 개발 관련 해서 많이 얘기했었는데, 그 말들을 알아듣는 것도 더 잘 알아듣게 됐다 ㅋㅋㅋ ㅋㅋ ㅋㅋㅋ<br />
처음 4주차 미션 받았을 때만 해도 이걸 구현할 수 있을까 엄청 막막하고, 이전 미션들보다 진행속도가 훨씬 느려서 엄청 걱정했는데 저번주 코수타에서 말씀해주셨던 가장 중요한 기능이 뭐냐! 를 생각해보니, 주문 넘기는 게 가장 중요하다 생각했다.<br />
그래서 그거부터 구현하고 테스트를 마치고 나니, 나머지 할인 계산이나 출력 같은 건 금방했다!<br />
다른 후기들에도 나와있듯이, 프리코스를 진행하는 것만으로도 많은 성장이 된 것 같다... 감회가 새롭구나 허허

![wooteco-6-4-4](/assets/images/wooteco-6-4-4.png)
